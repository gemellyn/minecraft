---
title: "Analyse des données Minecraft"
output: html_document
---

<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
</style>

```{r include = FALSE}
#install.packages("rmarkdown")
#install.packages("ggplot2")
#install.packages("hexbin")
#install.packages("data.table")
require(ggplot2)
require(data.table)
```


```{r echo=FALSE}
#------------------- configuration
logDataLoad = TRUE

#------------------- chargement des fichiers a partir du repertoire courant
# il faut des repertoirs dataxxxxx a la racine

dirs <- list.dirs(path = ".", full.names = TRUE, recursive = FALSE)
player_id <- 0

DTA <- data.table();
DTAAInt <- data.table();
DTAAIntPlayer <- data.table(); #actor actro interaction sur le joueur uniquement
DTAInt <- data.table();
DTAItemInt <- data.table();
DTAPos <- data.table();
DTPlaces <- data.table();
DTProcessInt <- data.table();
DTForm <- data.table();

if(logDataLoad)
  print("Chargement des donnees: ");

#On parse tous les dirs a la racine
for(d in dirs){
  if(logDataLoad)
    print(d);
  #si on est sur un rep de datas, c'est un nouveau joueur
  if(grepl("data",d)){
    if(logDataLoad)
      print("data");
    player_id <- player_id + 1;
    is_result = TRUE;
    
    #si c'est un rep de data mod ou vanilla, on a les bonnes vars, on load
    if(is_result){
      if(logDataLoad)
        print("Grabbing files...");
      
      #on recup le game mode
      if(logDataLoad) print("game_type.del");
      DTModeLoc <- as.data.table(read.csv(paste(d,"/game_type.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTModeLoc, old=c("V1","V2"), new=c("mode", "time"));
      DTModeLoc[, modeName:="vanilla"][mode==0, modeName:="mod"];
      
      if(logDataLoad) print("actor_interaction_kind.del");
      DTAIntKindLoc <- as.data.table(read.csv(paste(d,"/actor_interaction_kind.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAIntKindLoc, old=c("V1","V2"), new=c("action", "actionName"));
      
      if(logDataLoad) print("item_interaction_kind.del");
      DTItemIntKindLoc <- as.data.table(read.csv(paste(d,"/item_interaction_kind.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTItemIntKindLoc, old=c("V1","V2"), new=c("action", "actionName"));
      
      if(logDataLoad) print("actor.del");
      DTALoc <- as.data.table(read.csv(paste(d,"/actor.del",sep="" ),header=FALSE,sep=";"))
      DTALoc$MyPlayerId <- player_id
      setnames(DTALoc, old=c("V1","V2","V3","V4","V5","V6"), new=c("id", "name","kind","X","Y","Z"))
      DTA <- rbind(DTA,DTALoc);
      
      if(logDataLoad) print("actor_actor_interaction.del");
      DTAAIntLoc <- as.data.table(read.csv(paste(d,"/actor_actor_interaction.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAAIntLoc, old=c("V1","V2","V3","V4","V5","V6","V7","V8"), new=c("actor1", "actor2","V3","X","Y","Z","time","action"))
      DTAAIntLoc$MyPlayerId <- player_id
      DTAAIntLoc[, MyMod:=DTModeLoc[1]$modeName][time>DTModeLoc[2]$time, MyMod:=DTModeLoc[2]$modeName]
      
      #join sur les actions, pour avoir les bon noms d'action
      setkey(DTAIntKindLoc,action)
      setkey(DTAAIntLoc,action)
      DTAAIntLoc <- DTAAIntLoc[DTAIntKindLoc, nomatch=0]
      
      DTAAInt <- rbind(DTAAInt,DTAAIntLoc);
      DTAAIntPlayer <- rbind(DTAAIntPlayer,DTAAIntLoc[actor1==DTALoc[kind==0]$id] );
      DTAAIntPlayer <- rbind(DTAAIntPlayer,DTAAIntLoc[actor2==DTALoc[kind==0]$id] );
      
      if(logDataLoad) print("actor_interaction.del");
      DTAIntLoc <- as.data.table(read.csv(paste(d,"/actor_interaction.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAIntLoc, old=c("V1","V2","V3","V4","V5","V6","V7"), new=c("actor","X","Y","Z","time","action","V7"))
      DTAIntLoc$MyPlayerId <- player_id
      DTAIntLoc[, MyMod:=DTModeLoc[1]$modeName][time>=DTModeLoc[2]$time, MyMod:=DTModeLoc[2]$modeName]
      
      
      
      #join sur les actions, pour avoir les bon noms d'action
      setkey(DTAIntKindLoc,action)
      setkey(DTAIntLoc,action)
      DTAIntLoc <- DTAIntLoc[DTAIntKindLoc, nomatch=0]
      
      DTAInt <- rbind(DTAInt,DTAIntLoc);
      
      if(logDataLoad) print("actor_item_interaction.del");
      DTAItemIntLoc <- as.data.table(read.csv(paste(d,"/actor_item_interaction.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAItemIntLoc, old=c("V1","V2","V3","V4","V5","V6","V7"), new=c("actor","item","X","Y","Z","time","action"))
      DTAItemIntLoc$MyPlayerId <- player_id
      DTAItemIntLoc[, MyMod:=DTModeLoc[1]$modeName][time>=DTModeLoc[2]$time, MyMod:=DTModeLoc[2]$modeName]
      
      #join sur les actions, pour avoir les bon noms d'action
      setkey(DTItemIntKindLoc,action)
      setkey(DTAItemIntLoc,action)
      DTAItemIntLoc <- DTAItemIntLoc[DTItemIntKindLoc, nomatch=0]
      
      DTAItemInt <- rbind(DTAItemInt,DTAItemIntLoc);
      
      if(logDataLoad) print("actor_position.del");
      DTAPosLoc <- as.data.table(read.csv(paste(d,"/actor_position.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAPosLoc, old=c("V1","V2","V3","V4","V5"), new=c("actor","time","X","Y","Z"))
      DTAPosLoc$MyPlayerId <- player_id
      DTAPosLoc[, MyMod:=DTModeLoc[1]$modeName][time>=DTModeLoc[2]$time, MyMod:=DTModeLoc[2]$modeName]
      DTAPos <- rbind(DTAPos,DTAPosLoc);
      
      if(logDataLoad) print("place.del");
      DTPlacesLoc <- as.data.table(read.csv(paste(d,"/place.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTPlacesLoc, old=c("V1","V2","V3","V4"), new=c("id","X","Y","Z"))
      DTPlacesLoc$MyPlayerId <- player_id
      DTPlaces <- rbind(DTPlaces,DTPlacesLoc);
      if(logDataLoad)
        print(paste("add ",nrow(DTPlacesLoc)," places"));
      
      if(logDataLoad) print("process_interaction.del");
      processInt <- paste(d,"/process_interaction.del",sep="" )
      if (file.size(processInt) > 0) {
        DTProcessIntLoc <- as.data.table(read.csv(paste(d,"/process_interaction.del",sep="" ),header=FALSE,sep=";"))
        setnames(DTProcessIntLoc, old=c("V1","V2","V3","V4","V5","V6","V7"), new=c("id","name","X","Y","Z","time","kind"))
        DTProcessIntLoc$MyPlayerId <- player_id
        DTProcessInt <- rbind(DTProcessInt,DTProcessIntLoc);
      }
      
      #on recup le formulaire
      form_file <- list.files(path=d,pattern="answers.*\\csv");
      #on teste si y'a un fichier (impossible de faire un test correct, is null et companie, r me soule)
      if(paste("test",form_file,sep="") != "test"){
        DTFormLoc <- as.data.table(read.csv(paste(d,"/",form_file,sep="" ),header=TRUE,sep=";"))
        DTFormLoc$MyPlayerId <- player_id;
        DTFormLoc$FirstCondition <- DTModeLoc[1]$modeName;
        DTForm <- rbind(DTForm,DTFormLoc);
      }else{
        print(paste(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  ERROR : FORMULAIRE MANQUANT !!!! in ",d));
      }
      
      if(logDataLoad)
        print("... done");
      
      remove(DTPlacesLoc);
      remove(DTALoc);
      remove(DTAPosLoc);
      remove(DTAItemIntLoc);
      remove(DTAIntLoc);
      remove(DTAAIntLoc);
      remove(DTAIntKindLoc);
      remove(DTModeLoc);
      remove(DTItemIntKindLoc);
      remove(DTProcessIntLoc);
      remove(DTFormLoc);
    }
  }
}

DTPlaces <- as.data.table(DTPlaces)
DTAInt <- as.data.table(DTAInt)
DTAAInt <- as.data.table(DTAAInt)
DTAPos <- as.data.table(DTAPos)

```

###Description générale
```{r echo=FALSE}
nbPlayers <- nrow(DTAPos[,MyPlayerId,by=MyPlayerId])
playtime <- DTAPos[,list(playTime=floor((max(time)-min(time))/60)),by=.(MyMod,MyPlayerId)]
```
Expérience réalisée sur **`r nbPlayers`** joueurs, pour un playtime moyen de **`r round(mean(playtime$playTime),1)`** minutes ($\sigma$=`r round(sd(playtime$playTime),1)`) dans chaque mode de jeu. 

```{r echo=FALSE}
hist(playtime$playTime, xlab="Playtime (mins)", ylab="nombre de parties", main="Playtime")
```

```{r echo=FALSE}
# Comparaison du nombre de processus lancé avec les caractéristiques des parties
setkey(DTForm,MyPlayerId)
setkey(DTProcessInt,MyPlayerId)
DTFormProcess <- DTForm[DTProcessInt[kind==0], nomatch=0]

DTFormProcessIntNbTmp <- DTFormProcess[,nrow(.SD),by=MyPlayerId]

setkey(DTForm,MyPlayerId)
setkey(DTFormProcessIntNbTmp,MyPlayerId)
DTFormProcessInt <- DTForm[DTFormProcessIntNbTmp, nomatch=0]
setnames(DTFormProcessInt, old=c("V1"), new=c("nb"))
remove(DTFormProcessIntNbTmp);


# Données sur les caractéristiques des deux parties
DTFormSens <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormSens$v <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][sens==0][nb>=2], DTFormProcessInt[FirstCondition=="mod"][sens==4][nb>=2]))
DTFormSens$pv <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][sens==1][nb>=2], DTFormProcessInt[FirstCondition=="mod"][sens==3][nb>=2]))
DTFormSens$n <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][sens==2][nb>=2], DTFormProcessInt[FirstCondition=="mod"][sens==2][nb>=2]))
DTFormSens$pm <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][sens==3][nb>=2], DTFormProcessInt[FirstCondition=="mod"][sens==1][nb>=2]))
DTFormSens$m <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][sens==4][nb>=2], DTFormProcessInt[FirstCondition=="mod"][sens==0][nb>=2]))

DTFormSituations <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormSituations$v <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][situations==0][nb>=2], DTFormProcessInt[FirstCondition=="mod"][situations==4][nb>=2]))
DTFormSituations$pv <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][situations==1][nb>=2], DTFormProcessInt[FirstCondition=="mod"][situations==3][nb>=2]))
DTFormSituations$n <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][situations==2][nb>=2], DTFormProcessInt[FirstCondition=="mod"][situations==2][nb>=2]))
DTFormSituations$pm <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][situations==3][nb>=2], DTFormProcessInt[FirstCondition=="mod"][situations==1][nb>=2]))
DTFormSituations$m <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][situations==4][nb>=2], DTFormProcessInt[FirstCondition=="mod"][situations==0][nb>=2]))

DTFormInteret <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormInteret$v <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][interet==0][nb>=2], DTFormProcessInt[FirstCondition=="mod"][interet==4][nb>=2]))
DTFormInteret$pv <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][interet==1][nb>=2], DTFormProcessInt[FirstCondition=="mod"][interet==3][nb>=2]))
DTFormInteret$n <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][interet==2][nb>=2], DTFormProcessInt[FirstCondition=="mod"][interet==2][nb>=2]))
DTFormInteret$pm <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][interet==3][nb>=2], DTFormProcessInt[FirstCondition=="mod"][interet==1][nb>=2]))
DTFormInteret$m <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][interet==4][nb>=2], DTFormProcessInt[FirstCondition=="mod"][interet==0][nb>=2]))

DTFormLogique <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormLogique$v <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][logique==0][nb>=2], DTFormProcessInt[FirstCondition=="mod"][logique==4][nb>=2]))
DTFormLogique$pv <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][logique==1][nb>=2], DTFormProcessInt[FirstCondition=="mod"][logique==3][nb>=2]))
DTFormLogique$n <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][logique==2][nb>=2], DTFormProcessInt[FirstCondition=="mod"][logique==2][nb>=2]))
DTFormLogique$pm <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][logique==3][nb>=2], DTFormProcessInt[FirstCondition=="mod"][logique==1][nb>=2]))
DTFormLogique$m <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][logique==4][nb>=2], DTFormProcessInt[FirstCondition=="mod"][logique==0][nb>=2]))

DTFormFaire <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormFaire$v <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][faire==0][nb>=2], DTFormProcessInt[FirstCondition=="mod"][faire==4][nb>=2]))
DTFormFaire$pv <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][faire==1][nb>=2], DTFormProcessInt[FirstCondition=="mod"][faire==3][nb>=2]))
DTFormFaire$n <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][faire==2][nb>=2], DTFormProcessInt[FirstCondition=="mod"][faire==2][nb>=2]))
DTFormFaire$pm <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][faire==3][nb>=2], DTFormProcessInt[FirstCondition=="mod"][faire==1][nb>=2]))
DTFormFaire$m <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][faire==4][nb>=2], DTFormProcessInt[FirstCondition=="mod"][faire==0][nb>=2]))

DTFormObjectifs <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormObjectifs$v <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==0][nb>=2], DTFormProcessInt[FirstCondition=="mod"][objectifs==4][nb>=2]))
DTFormObjectifs$pv <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==1][nb>=2], DTFormProcessInt[FirstCondition=="mod"][objectifs==3][nb>=2]))
DTFormObjectifs$n <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==2][nb>=2], DTFormProcessInt[FirstCondition=="mod"][objectifs==2][nb>=2]))
DTFormObjectifs$pm <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==3][nb>=2], DTFormProcessInt[FirstCondition=="mod"][objectifs==1][nb>=2]))
DTFormObjectifs$m <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==4][nb>=2], DTFormProcessInt[FirstCondition=="mod"][objectifs==0][nb>=2]))

DTFormManques <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormManques$v <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][manques==0][nb>=2], DTFormProcessInt[FirstCondition=="mod"][manques==4][nb>=2]))
DTFormManques$pv <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][manques==1][nb>=2], DTFormProcessInt[FirstCondition=="mod"][manques==3][nb>=2]))
DTFormManques$n <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][manques==2][nb>=2], DTFormProcessInt[FirstCondition=="mod"][manques==2][nb>=2]))
DTFormManques$pm <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][manques==3][nb>=2], DTFormProcessInt[FirstCondition=="mod"][manques==1][nb>=2]))
DTFormManques$m <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][manques==4][nb>=2], DTFormProcessInt[FirstCondition=="mod"][manques==0][nb>=2]))

DTFormSurpris <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormSurpris$v <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][surpris==0][nb>=2], DTFormProcessInt[FirstCondition=="mod"][surpris==4][nb>=2]))
DTFormSurpris$pv <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][surpris==1][nb>=2], DTFormProcessInt[FirstCondition=="mod"][surpris==3][nb>=2]))
DTFormSurpris$n <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][surpris==2][nb>=2], DTFormProcessInt[FirstCondition=="mod"][surpris==2][nb>=2]))
DTFormSurpris$pm <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][surpris==3][nb>=2], DTFormProcessInt[FirstCondition=="mod"][surpris==1][nb>=2]))
DTFormSurpris$m <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][surpris==4][nb>=2], DTFormProcessInt[FirstCondition=="mod"][surpris==0][nb>=2]))

DTFormPlaisir <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormPlaisir$v <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==0][nb>=2], DTFormProcessInt[FirstCondition=="mod"][plaisir==4][nb>=2]))
DTFormPlaisir$pv <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==1][nb>=2], DTFormProcessInt[FirstCondition=="mod"][plaisir==3][nb>=2]))
DTFormPlaisir$n <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==2][nb>=2], DTFormProcessInt[FirstCondition=="mod"][plaisir==2][nb>=2]))
DTFormPlaisir$pm <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==3][nb>=2], DTFormProcessInt[FirstCondition=="mod"][plaisir==1][nb>=2]))
DTFormPlaisir$m <- nrow(rbind(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==4][nb>=2], DTFormProcessInt[FirstCondition=="mod"][plaisir==0][nb>=2]))

# transformer dtform de façon a avoir pour le q characteristic 1 = v, 2 = pv, 3 = n, 4 = pm etc.

#Transformer pour que pour tout le monde, ca soit 1  plutot vanilla, 5 plutot mod
DTForm$plaisirPlutotMod = DTForm$plaisir;
DTForm[FirstCondition=="mod",plaisirPlutotMod := as.integer(6-plaisir)]

echoPValue <- function(pv){
  
  pv = signif(pv,digits=2)
   
  if(pv<0.001) {
    return(paste(pv,"***"));
  }else if(pv<0.01){ 
    return(paste(pv,"**"));
  }else  if(pv<0.05){ 
    return(paste(pv,"*"));
  }else if(pv<0.1){ 
    return(paste(pv,"."));
  }else{
    return(paste(pv,":("));
  }
  
  return("");
}


res=data.table(vide=0);
res$sens <- echoPValue(t.test(DTForm$sens ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$plaisir <- echoPValue(t.test(DTForm$plaisir ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$interet <- echoPValue(t.test(DTForm$interet ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$faire <- echoPValue(t.test(DTForm$faire ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$situations <- echoPValue(t.test(DTForm$situations ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$surpris <- echoPValue(t.test(DTForm$surpris ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$objectifs <- echoPValue(t.test(DTForm$objectifs ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$manques <- echoPValue(t.test(DTForm$manques ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$logique <- echoPValue(t.test(DTForm$logique ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)


hist(DTFormProcessInt$nb, main="utilisation des processus", xlab="Processus")

barplot(DTFormPlaisir$v, main="Plaisir de jeu par partie", xlab="Partie")

montest <- function(table){
  DTTest <- data.table(nombre=t(table[1]))
  DTTest$content <- 1:5
  print(plot(DTTest))
  fit <- glm(content ~ nombre.V1, data=DTTest)
  print(summary(fit))  
}

DTTest <- data.table(nombre=t(DTFormPlaisir[1]))
barplot(DTTest$nombre.V1)

montest(DTFormPlaisir)
montest(DTFormSens)
montest(DTFormSituations)
montest(DTFormSurpris)
montest(DTFormPlaisir)


barplot(table(DTForm$frequence), xlab="Fréquence", ylab="Nombre de personnes", main="Fréquence de jeu",las=2)
barplot(table(DTForm$age), xlab="Age", ylab="Nombre de personnes", main="Répartition de la population par âge",las=2)
barplot(table(DTForm$minecraft), xlab="Expérience", ylab="Nombre de personnes", main="Expérience de Minecraft",las=2)
barplot(table(DTAInt$actionName), xlab="Actions", ylab="frequence", main="Actor interaction",las=2)
barplot(table(DTAAInt$actionName), xlab="Actions", ylab="frequence", main="Actor Actor interaction",las=2)

DTPlacesNbPlaces <- DTPlaces[,.(nbPlaces=nrow(.SD)),by=.(MyPlayerId)]
barplot(table(DTPlacesNbPlaces$nbPlaces), xlab="Nb places", ylab="frequence", main="Number of places")
```

###Cartes
```{r fig.width=4, fig.height=4,echo=FALSE,out.extra=' style="float:left"'}
#trace les cartes

#on prend les positions min et max sans tenir compte du mod, pour avoir les memes echelles sur les plots
DTAPosMinMax <- DTAPos[,.(minX=min(X),maxX=max(X),minZ=min(Z),maxZ=max(Z)),by=.(MyPlayerId)]

plotMap <- function (xs,ys,mod,player){
  df <- data.frame(x=xs,y=ys)
  pl <- ggplot(df,aes(x=xs,y=ys))
  pl <- pl + geom_point(alpha = 0.2) #+ stat_binhex() 
  pl <- pl + ggtitle(paste(player,mod))
  df <- data.frame(x=mean(xs),y=mean(ys))
  pl <- pl + geom_point(data = df, aes(x=mean(xs),y=mean(ys)), colour = "red")
  
  DTPlaceNow <- DTPlaces[MyPlayerId==player];
  df <- data.frame(x=DTPlaceNow$X,y=DTPlaceNow$Z)
  pl <- pl + geom_point(data = df, aes(x=df$x,y=df$y), colour = "green")
  
  DTMinMaxNow <- DTAPosMinMax[MyPlayerId==player];
  pl <- pl + xlim(DTMinMaxNow$minX,DTMinMaxNow$maxX)
  pl <- pl + ylim(DTMinMaxNow$minZ,DTMinMaxNow$maxZ)
  
  print(pl)  
}
setkey(DTAPos,MyPlayerId,time)
void <- DTAPos[,{plotMap(X,Z,MyMod,MyPlayerId);NULL},by=.(MyMod,MyPlayerId)]
```
<div style="clear:both">&nbsp;</div>

```{r echo=FALSE}
###Lien entre mode de jeu et nombre de lieux
###ERROR : on ne stoque pas le temps de lieux, donc impossible de comparer le nombre de lieux entre chaque mod

#ajout des variables
#DTPlacesNbPlaces <- DTPlaces[,.(nbPlaces=nrow(.SD)),by=.(MyMod,MyPlayerId)]
#barplot(table(DTPlacesNbPlaces$nbPlaces), xlab="Nb places", ylab="frequence", main="Number of places")
#print(DTPlacesNbPlaces)

#data <- DTPlacesNbPlaces[MyMod=="vanilla",nbPlaces] - DTPlacesNbPlaces[MyMod=="mod",nbPlaces];
#hist(data,xlab="diff nbLieux  (vanilla - mod)", main="Delta nombre de lieux vanilla/mod")

#lien 
#fit <- aov(nbPlaces ~ MyMod, data=DTPlacesNbPlaces)
#summary(fit)
```

###Lien entre mode de jeu et nombre d'interaction

```{r echo=FALSE}
#ajout des variables
DTAAIntNb <- DTAAIntPlayer[,.(nbInt=nrow(.SD)),by=.(MyMod,MyPlayerId)]
DTAIntNb <- DTAInt[,.(nbInt=nrow(.SD)),by=.(MyMod,MyPlayerId)]
DTIntNb <- DTAAIntNb
DTIntNb$nbInt = DTAAIntNb$nbInt + DTAIntNb$nbInt

#lien 
fit <- aov(nbInt ~ MyMod, data=DTIntNb)
sum_fit = unlist(summary(fit))
```

Le nombre d'interactions est en moyenne de **`r round(mean(DTIntNb[MyMod=="vanilla"]$nbInt))`** ($\sigma$=`r round(sd(DTIntNb[MyMod=="vanilla"]$nbInt),1)`) en mode vanilla et de **`r round(mean(DTIntNb[MyMod=="mod"]$nbInt))`** ($\sigma$=`r round(sd(DTIntNb[MyMod=="mod"]$nbInt),1)`) en mode narration émergente. Cette différence a un taux de significativité de **`r sum_fit["Pr(>F)1"]`** 

```{r echo=FALSE}
#data <- DTIntNb[MyMod=="vanilla",nbInt]
#data <- rbind(data,DTIntNb[MyMod=="mod",nbInt])
#barplot(data, xlab="nbActions pour chaque joueur vanilla/mod", ylab="frequence", main="Actor Actor interaction", beside=TRUE,col=c("orange","darkgreen"))
data <- DTIntNb[MyMod=="vanilla",nbInt] - DTIntNb[MyMod=="mod",nbInt];
hist(data,xlab="diff nbActions  (vanilla - mod)", main="Delta quantite d'interaction vanilla/mod")
summary(fit)
```


###Lien entre mode de jeu et mort du joueur
```{r echo=FALSE}
#ajout des variables
DTAAIntNb <- DTAAIntPlayer[action==9,.(nbInt=nrow(.SD)),by=.(MyMod,MyPlayerId)]

#on met à 0 la ou il y'a des NA (si un mec est pas mort dans un mode)
DTAAIntNb <- merge(DTAAIntNb[,CJ(MyMod=unique(MyMod),MyPlayerId=unique(MyPlayerId))],DTAAIntNb,by=c('MyPlayerId','MyMod'),all=TRUE)[,.(MyMod,MyPlayerId,nbInt=ifelse(!is.na(nbInt),nbInt,0))]



#DTAIntNb <- DTAInt[action==9,.(nbInt=nrow(.SD)),by=.(MyMod,MyPlayerId)]
DTIntNb <- DTAAIntNb
#DTIntNb$nbInt = DTAAIntNb$nbInt + DTAIntNb$nbInt
print(DTIntNb)
#data <- DTIntNb[MyMod=="vanilla",nbInt]
#data <- rbind(data,DTIntNb[MyMod=="mod",nbInt])
#barplot(data, xlab="nbMorts pour chaque joueur vanilla/mod", ylab="frequence", main="Actor Actor interaction", beside=TRUE,col=c("orange","darkgreen"))
data <- DTIntNb[MyMod=="vanilla",nbInt] - DTIntNb[MyMod=="mod",nbInt];
hist(data,xlab="diff nbMorts  (vanilla - mod)", main="Delta quantite mort joueur vanilla/mod")
#lien 
fit <- aov(nbInt ~ MyMod, data=DTIntNb)
#plot(x=DTLoc$nbFail, y=DTLoc$erreurdiff, main=titre)
summary(fit)
```

###Lien entre mode de jeu et distance au barycentre (valeur absolue)
```{r echo=FALSE}
#calcul du barycentre
DTAPosBarycentre <- DTAPos[,.(xBar=mean(X),yBar=mean(Y),zBar=mean(Z)),by=.(MyMod,MyPlayerId)]
DTADistBarycentre <- DTAPos[,.(dist=sqrt((X-mean(X)) * (X-mean(X)) + (Y-mean(Y)) * (Y-mean(Y)) + (Z-mean(Z)) * (Z-mean(Z)) )),by=.(MyMod,MyPlayerId)]
DTADistBarycentreMean <- DTADistBarycentre[,.(mdist=mean(dist),sddist=sd(dist)),by=.(MyMod,MyPlayerId)]
print(DTADistBarycentreMean)

data <- DTADistBarycentreMean[MyMod=="vanilla",mdist] - DTADistBarycentreMean[MyMod=="mod",mdist];
hist(data,xlab="diff dist barycentre vanilla - mod", main="Delta dist barycentre vanilla/mod")

#lien 
fit <- aov(mdist ~ MyMod, data=DTADistBarycentreMean)
#plot(x=DTLoc$nbFail, y=DTLoc$erreurdiff, main=titre)
summary(fit)
```

###Lien entre mode de jeu et distance totale (valeur absolue)
```{r echo=FALSE}
#calcul du barycentre
setkeyv(DTAPos,c("MyPlayerId","time"))
DTADistStep <- DTAPos[,.(dist=sqrt((X-lag(X)) * (X-lag(X)) + (Y-lag(Y)) * (Y-lag(Y)) + (Z-lag(Z)) * (Z-lag(Z)) )),by=.(MyMod,MyPlayerId)]

DTADistStep <- DTAPos[,.(dx=(X-c(X[1], X[-.N])),dy=(Y-c(Y[1], Y[-.N])),dz=(Z-c(Z[1], Z[-.N]))),by=.(MyMod,MyPlayerId)]
DTADistStep <- DTADistStep[,.(dist=sqrt(dx*dx+dz*dz+dy*dy)),by=.(MyMod,MyPlayerId)]
DTADistStep <- DTADistStep[,.(distSum=sum(dist)),by=.(MyMod,MyPlayerId)]

print(DTADistStep)

data <- DTADistStep[MyMod=="vanilla",distSum] - DTADistStep[MyMod=="mod",distSum];
hist(data,xlab="diff distance totale  vanilla - mod", main="Delta dist totale vanilla/mod")

#lien 
fit <- aov(distSum ~ MyMod, data=DTADistStep)
#plot(x=DTLoc$nbFail, y=DTLoc$erreurdiff, main=titre)
summary(fit)
```

###Idees fit :
- à trouver

###Idees descriptif:
- quantite d'interaction avec les process

###Nettoyage
- virer ceux qui n'ont pas joue tout le temps (temps sans action trop long)
- virer ceux qui n'ont eu que vanilla ou que mod (table game_type avec une seule ligne)



