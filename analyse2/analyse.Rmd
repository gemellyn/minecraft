---
title: "Analyse des données Minecraft"
output: html_document
---

<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
</style>

```{r include = FALSE}
#install.packages("rmarkdown")
#install.packages("ggplot2")
#install.packages("hexbin")
#install.packages("data.table")
require(ggplot2)
require(data.table)
```


```{r echo=FALSE}
#------------------- configuration
logDataLoad = TRUE

#------------------- chargement des fichiers a partir du repertoire courant
# il faut des repertoirs dataxxxxx a la racine

dirs <- list.dirs(path = ".", full.names = TRUE, recursive = FALSE)
player_id <- 0

DTA <- data.table();
DTAAInt <- data.table();
DTAAIntPlayer <- data.table(); #actor actro interaction sur le joueur uniquement
DTAInt <- data.table();
DTAItemInt <- data.table();
DTAPos <- data.table();
DTPlaces <- data.table();
DTProcessInt <- data.table();
DTForm <- data.table();

if(logDataLoad)
  print("Chargement des donnees: ");

#On parse tous les dirs a la racine
for(d in dirs){
  if(logDataLoad)
    print(d);
  #si on est sur un rep de datas, c'est un nouveau joueur
  if(grepl("data",d)){
    if(logDataLoad)
      print("data");
    player_id <- player_id + 1;
    is_result = TRUE;
    
    #si c'est un rep de data mod ou vanilla, on a les bonnes vars, on load
    if(is_result){
      if(logDataLoad)
        print("Grabbing files...");
      
      #on recup le game mode
      if(logDataLoad) print("game_type.del");
      DTModeLoc <- as.data.table(read.csv(paste(d,"/game_type.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTModeLoc, old=c("V1","V2"), new=c("mode", "time"));
      DTModeLoc[, modeName:="vanilla"][mode==0, modeName:="mod"];
      
      if(logDataLoad) print("actor_interaction_kind.del");
      DTAIntKindLoc <- as.data.table(read.csv(paste(d,"/actor_interaction_kind.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAIntKindLoc, old=c("V1","V2"), new=c("action", "actionName"));
      
      if(logDataLoad) print("item_interaction_kind.del");
      DTItemIntKindLoc <- as.data.table(read.csv(paste(d,"/item_interaction_kind.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTItemIntKindLoc, old=c("V1","V2"), new=c("action", "actionName"));
      
      if(logDataLoad) print("actor.del");
      DTALoc <- as.data.table(read.csv(paste(d,"/actor.del",sep="" ),header=FALSE,sep=";"))
      DTALoc$MyPlayerId <- player_id
      setnames(DTALoc, old=c("V1","V2","V3","V4","V5","V6"), new=c("id", "name","kind","X","Y","Z"))
      DTA <- rbind(DTA,DTALoc);
      
      if(logDataLoad) print("actor_actor_interaction.del");
      DTAAIntLoc <- as.data.table(read.csv(paste(d,"/actor_actor_interaction.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAAIntLoc, old=c("V1","V2","V3","V4","V5","V6","V7","V8"), new=c("actor1", "actor2","V3","X","Y","Z","time","action"))
      DTAAIntLoc$MyPlayerId <- player_id
      DTAAIntLoc[, MyMod:=DTModeLoc[1]$modeName][time>DTModeLoc[2]$time, MyMod:=DTModeLoc[2]$modeName]
      
      #join sur les actions, pour avoir les bon noms d'action
      setkey(DTAIntKindLoc,action)
      setkey(DTAAIntLoc,action)
      DTAAIntLoc <- DTAAIntLoc[DTAIntKindLoc, nomatch=0]
      
      DTAAInt <- rbind(DTAAInt,DTAAIntLoc);
      DTAAIntPlayer <- rbind(DTAAIntPlayer,DTAAIntLoc[actor1==DTALoc[kind==0]$id] );
      DTAAIntPlayer <- rbind(DTAAIntPlayer,DTAAIntLoc[actor2==DTALoc[kind==0]$id] );
      
      if(logDataLoad) print("actor_interaction.del");
      DTAIntLoc <- as.data.table(read.csv(paste(d,"/actor_interaction.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAIntLoc, old=c("V1","V2","V3","V4","V5","V6","V7"), new=c("actor","X","Y","Z","time","action","V7"))
      DTAIntLoc$MyPlayerId <- player_id
      DTAIntLoc[, MyMod:=DTModeLoc[1]$modeName][time>=DTModeLoc[2]$time, MyMod:=DTModeLoc[2]$modeName]
      
      
      
      #join sur les actions, pour avoir les bon noms d'action
      setkey(DTAIntKindLoc,action)
      setkey(DTAIntLoc,action)
      DTAIntLoc <- DTAIntLoc[DTAIntKindLoc, nomatch=0]
      
      DTAInt <- rbind(DTAInt,DTAIntLoc);
      
      if(logDataLoad) print("actor_item_interaction.del");
      DTAItemIntLoc <- as.data.table(read.csv(paste(d,"/actor_item_interaction.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAItemIntLoc, old=c("V1","V2","V3","V4","V5","V6","V7"), new=c("actor","item","X","Y","Z","time","action"))
      DTAItemIntLoc$MyPlayerId <- player_id
      DTAItemIntLoc[, MyMod:=DTModeLoc[1]$modeName][time>=DTModeLoc[2]$time, MyMod:=DTModeLoc[2]$modeName]
      
      #join sur les actions, pour avoir les bon noms d'action
      setkey(DTItemIntKindLoc,action)
      setkey(DTAItemIntLoc,action)
      DTAItemIntLoc <- DTAItemIntLoc[DTItemIntKindLoc, nomatch=0]
      
      DTAItemInt <- rbind(DTAItemInt,DTAItemIntLoc);
      
      if(logDataLoad) print("actor_position.del");
      DTAPosLoc <- as.data.table(read.csv(paste(d,"/actor_position.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTAPosLoc, old=c("V1","V2","V3","V4","V5"), new=c("actor","time","X","Y","Z"))
      DTAPosLoc$MyPlayerId <- player_id
      DTAPosLoc[, MyMod:=DTModeLoc[1]$modeName][time>=DTModeLoc[2]$time, MyMod:=DTModeLoc[2]$modeName]
      DTAPos <- rbind(DTAPos,DTAPosLoc);
      
      if(logDataLoad) print("place.del");
      DTPlacesLoc <- as.data.table(read.csv(paste(d,"/place.del",sep="" ),header=FALSE,sep=";"))
      setnames(DTPlacesLoc, old=c("V1","V2","V3","V4"), new=c("id","X","Y","Z"))
      DTPlacesLoc$MyPlayerId <- player_id
      DTPlaces <- rbind(DTPlaces,DTPlacesLoc);
      if(logDataLoad)
        print(paste("add ",nrow(DTPlacesLoc)," places"));
      
      if(logDataLoad) print("process_interaction.del");
      processInt <- paste(d,"/process_interaction.del",sep="" )
      if (file.size(processInt) > 0) {
        DTProcessIntLoc <- as.data.table(read.csv(paste(d,"/process_interaction.del",sep="" ),header=FALSE,sep=";"))
        setnames(DTProcessIntLoc, old=c("V1","V2","V3","V4","V5","V6","V7"), new=c("id","name","X","Y","Z","time","kind"))
        DTProcessIntLoc$MyPlayerId <- player_id
        DTProcessInt <- rbind(DTProcessInt,DTProcessIntLoc);
      }
      
      #on recup le formulaire
      form_file <- list.files(path=d,pattern="answers.*\\csv");
      #on teste si y'a un fichier (impossible de faire un test correct, is null et companie, r me soule)
      if(paste("test",form_file,sep="") != "test"){
        DTFormLoc <- as.data.table(read.csv(paste(d,"/",form_file,sep="" ),header=TRUE,sep=";"))
        DTFormLoc$MyPlayerId <- player_id;
        DTFormLoc$FirstCondition <- DTModeLoc[1]$modeName;
        DTForm <- rbind(DTForm,DTFormLoc);
      }else{
        print(paste(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  ERROR : FORMULAIRE MANQUANT !!!! in ",d));
      }
      
      if(logDataLoad)
        print("... done");
      
      remove(DTPlacesLoc);
      remove(DTALoc);
      remove(DTAPosLoc);
      remove(DTAItemIntLoc);
      remove(DTAIntLoc);
      remove(DTAAIntLoc);
      remove(DTAIntKindLoc);
      remove(DTModeLoc);
      remove(DTItemIntKindLoc);
      remove(DTProcessIntLoc);
      remove(DTFormLoc);
    }
  }
}

DTPlaces <- as.data.table(DTPlaces)
DTAInt <- as.data.table(DTAInt)
DTAAInt <- as.data.table(DTAAInt)
DTAPos <- as.data.table(DTAPos)

```

###Description générale
```{r echo=FALSE}
nbPlayers <- nrow(DTAPos[,MyPlayerId,by=MyPlayerId])
playtime <- DTAPos[,list(playTime=floor((max(time)-min(time))/60)),by=.(MyMod,MyPlayerId)]
```
Expérience réalisée sur **`r nbPlayers`** joueurs, pour un playtime moyen de **`r round(mean(playtime$playTime),1)`** minutes ($\sigma$=`r round(sd(playtime$playTime),1)`) dans chaque mode de jeu. 

```{r echo=FALSE}
hist(playtime$playTime, xlab="Playtime (mins)", ylab="nombre de parties", main="Playtime")
```

```{r echo=FALSE}
# Comparaison du nombre de processus lancé avec les caractéristiques des parties
setkey(DTForm,MyPlayerId)
setkey(DTProcessInt,MyPlayerId)
DTFormProcess <- DTForm[DTProcessInt[kind==0], nomatch=0]

DTFormProcessIntNbTmp <- DTFormProcess[,nrow(.SD),by=MyPlayerId]

setkey(DTForm,MyPlayerId)
setkey(DTFormProcessIntNbTmp,MyPlayerId)
DTFormProcessInt <- DTForm[DTFormProcessIntNbTmp, nomatch=0]
setnames(DTFormProcessInt, old=c("V1"), new=c("nb"))
remove(DTFormProcessIntNbTmp);


# Reponses au questionnaire comparatif sur les caractéristiques des deux parties
DTFormSensVanillaFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormSensVanillaFirst$v <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][sens==0])
DTFormSensVanillaFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][sens==1])
DTFormSensVanillaFirst$n <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][sens==2])
DTFormSensVanillaFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][sens==3])
DTFormSensVanillaFirst$m <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][sens==4])

DTFormSituationsVanillaFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormSituationsVanillaFirst$v <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][situations==0])
DTFormSituationsVanillaFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][situations==1])
DTFormSituationsVanillaFirst$n <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][situations==2])
DTFormSituationsVanillaFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][situations==3])
DTFormSituationsVanillaFirst$m <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][situations==4])

DTFormInteretVanillaFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormInteretVanillaFirst$v <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][interet==0])
DTFormInteretVanillaFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][interet==1])
DTFormInteretVanillaFirst$n <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][interet==2])
DTFormInteretVanillaFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][interet==3])
DTFormInteretVanillaFirst$m <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][interet==4])

DTFormLogiqueVanillaFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormLogiqueVanillaFirst$v <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][logique==0])
DTFormLogiqueVanillaFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][logique==1])
DTFormLogiqueVanillaFirst$n <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][logique==2])
DTFormLogiqueVanillaFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][logique==3])
DTFormLogiqueVanillaFirst$m <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][logique==4])

DTFormFaireVanillaFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormFaireVanillaFirst$v <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][faire==0])
DTFormFaireVanillaFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][faire==1])
DTFormFaireVanillaFirst$n <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][faire==2])
DTFormFaireVanillaFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][faire==3])
DTFormFaireVanillaFirst$m <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][faire==4])

DTFormObjectifsVanillaFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormObjectifsVanillaFirst$v <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==0])
DTFormObjectifsVanillaFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==1])
DTFormObjectifsVanillaFirst$n <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==2])
DTFormObjectifsVanillaFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==3])
DTFormObjectifsVanillaFirst$m <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][objectifs==4])

DTFormManquesVanillaFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormManquesVanillaFirst$v <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][manques==0])
DTFormManquesVanillaFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][manques==1])
DTFormManquesVanillaFirst$n <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][manques==2])
DTFormManquesVanillaFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][manques==3])
DTFormManquesVanillaFirst$m <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][manques==4])

DTFormSurprisVanillaFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormSurprisVanillaFirst$v <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][surpris==0])
DTFormSurprisVanillaFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][surpris==1])
DTFormSurprisVanillaFirst$n <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][surpris==2])
DTFormSurprisVanillaFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][surpris==3])
DTFormSurprisVanillaFirst$m <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][surpris==4])

DTFormPlaisirVanillaFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormPlaisirVanillaFirst$v <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==0])
DTFormPlaisirVanillaFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==1])
DTFormPlaisirVanillaFirst$n <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==2])
DTFormPlaisirVanillaFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==3])
DTFormPlaisirVanillaFirst$m <- nrow(DTFormProcessInt[FirstCondition=="vanilla"][plaisir==4])

DTFormSensModFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormSensModFirst$v <- nrow(DTFormProcessInt[FirstCondition=="mod"][sens==4])
DTFormSensModFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="mod"][sens==3])
DTFormSensModFirst$n <- nrow(DTFormProcessInt[FirstCondition=="mod"][sens==2])
DTFormSensModFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="mod"][sens==1])
DTFormSensModFirst$m <- nrow(DTFormProcessInt[FirstCondition=="mod"][sens==0])

DTFormSituationsModFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormSituationsModFirst$v <- nrow(DTFormProcessInt[FirstCondition=="mod"][situations==4])
DTFormSituationsModFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="mod"][situations==3])
DTFormSituationsModFirst$n <- nrow(DTFormProcessInt[FirstCondition=="mod"][situations==2])
DTFormSituationsModFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="mod"][situations==1])
DTFormSituationsModFirst$m <- nrow(DTFormProcessInt[FirstCondition=="mod"][situations==0])

DTFormInteretModFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormInteretModFirst$v <- nrow(DTFormProcessInt[FirstCondition=="mod"][interet==4])
DTFormInteretModFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="mod"][interet==3])
DTFormInteretModFirst$n <- nrow(DTFormProcessInt[FirstCondition=="mod"][interet==2])
DTFormInteretModFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="mod"][interet==1])
DTFormInteretModFirst$m <- nrow(DTFormProcessInt[FirstCondition=="mod"][interet==0])

DTFormLogiqueModFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormLogiqueModFirst$v <- nrow(DTFormProcessInt[FirstCondition=="mod"][logique==4])
DTFormLogiqueModFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="mod"][logique==3])
DTFormLogiqueModFirst$n <- nrow(DTFormProcessInt[FirstCondition=="mod"][logique==2])
DTFormLogiqueModFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="mod"][logique==1])
DTFormLogiqueModFirst$m <- nrow(DTFormProcessInt[FirstCondition=="mod"][logique==0])

DTFormFaireModFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormFaireModFirst$v <- nrow(DTFormProcessInt[FirstCondition=="mod"][faire==4])
DTFormFaireModFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="mod"][faire==3])
DTFormFaireModFirst$n <- nrow(DTFormProcessInt[FirstCondition=="mod"][faire==2])
DTFormFaireModFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="mod"][faire==1])
DTFormFaireModFirst$m <- nrow(DTFormProcessInt[FirstCondition=="mod"][faire==0])

DTFormObjectifsModFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormObjectifsModFirst$v <- nrow(DTFormProcessInt[FirstCondition=="mod"][objectifs==4])
DTFormObjectifsModFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="mod"][objectifs==3])
DTFormObjectifsModFirst$n <- nrow(DTFormProcessInt[FirstCondition=="mod"][objectifs==2])
DTFormObjectifsModFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="mod"][objectifs==1])
DTFormObjectifsModFirst$m <- nrow(DTFormProcessInt[FirstCondition=="mod"][objectifs==0])

DTFormManquesModFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormManquesModFirst$v <- nrow(DTFormProcessInt[FirstCondition=="mod"][manques==4])
DTFormManquesModFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="mod"][manques==3])
DTFormManquesModFirst$n <- nrow(DTFormProcessInt[FirstCondition=="mod"][manques==2])
DTFormManquesModFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="mod"][manques==1])
DTFormManquesModFirst$m <- nrow(DTFormProcessInt[FirstCondition=="mod"][manques==0])

DTFormSurprisModFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormSurprisModFirst$v <- nrow(DTFormProcessInt[FirstCondition=="mod"][surpris==4])
DTFormSurprisModFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="mod"][surpris==3])
DTFormSurprisModFirst$n <- nrow(DTFormProcessInt[FirstCondition=="mod"][surpris==2])
DTFormSurprisModFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="mod"][surpris==1])
DTFormSurprisModFirst$m <- nrow(DTFormProcessInt[FirstCondition=="mod"][surpris==0])

DTFormPlaisirModFirst <- data.table(v = "vanilla", pv="plutot vanilla", n="ni l'une ni l'autre", pm="plutot mod", m="mod")
DTFormPlaisirModFirst$v <- nrow(DTFormProcessInt[FirstCondition=="mod"][plaisir==4])
DTFormPlaisirModFirst$pv <- nrow(DTFormProcessInt[FirstCondition=="mod"][plaisir==3])
DTFormPlaisirModFirst$n <- nrow(DTFormProcessInt[FirstCondition=="mod"][plaisir==2])
DTFormPlaisirModFirst$pm <- nrow(DTFormProcessInt[FirstCondition=="mod"][plaisir==1])
DTFormPlaisirModFirst$m <- nrow(DTFormProcessInt[FirstCondition=="mod"][plaisir==0])

DTFormSens <- rbind(DTFormSensVanillaFirst, DTFormSensModFirst)
DTFormSituations <- rbind(DTFormSituationsVanillaFirst, DTFormSituationsModFirst)
DTFormInteret <- rbind(DTFormInteretVanillaFirst, DTFormInteretModFirst)
DTFormLogique <- rbind(DTFormLogiqueVanillaFirst, DTFormLogiqueModFirst)
DTFormFaire <- rbind(DTFormFaireVanillaFirst, DTFormFaireModFirst)
DTFormObjectifs <- rbind(DTFormObjectifsVanillaFirst, DTFormObjectifsModFirst)
DTFormManques <- rbind(DTFormManquesVanillaFirst, DTFormManquesModFirst)
DTFormSurpris <- rbind(DTFormSurprisVanillaFirst, DTFormSurprisModFirst)
DTFormPlaisir <- rbind(DTFormPlaisirVanillaFirst, DTFormPlaisirModFirst)

# Distribution de l'ordre des parties
barplot(table(DTFormProcessInt$FirstCondition), xlab="Première partie", ylab="Nombre de personnes", main="Ordre des parties",las=2)

barplot(data.table(rbind(DTFormSens$v, DTFormSens$pv, DTFormSens$n, DTFormSens$pm, DTFormSens$m))$V1, main="Sens pour première partie vanilla", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormSens$v, DTFormSens$pv, DTFormSens$n, DTFormSens$pm, DTFormSens$m))$V2, main="Sens pour première partie mod", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormSens[1]$v + DTFormSens[2]$v, DTFormSens[1]$pv + DTFormSens[2]$pv, DTFormSens[1]$n + DTFormSens[2]$n, DTFormSens[1]$pm + DTFormSens[2]$pm, DTFormSens[1]$m + DTFormSens[2]$m))$V1, main="Sens total", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")

barplot(data.table(rbind(DTFormSituations$v, DTFormSituations$pv, DTFormSituations$n, DTFormSituations$pm, DTFormSituations$m))$V1, main="Situations pour première partie vanilla", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormSituations$v, DTFormSituations$pv, DTFormSituations$n, DTFormSituations$pm, DTFormSituations$m))$V2, main="Situations pour première partie mod", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormSituations[1]$v + DTFormSituations[2]$v, DTFormSituations[1]$pv + DTFormSituations[2]$pv, DTFormSituations[1]$n + DTFormSituations[2]$n, DTFormSituations[1]$pm + DTFormSituations[2]$pm, DTFormSituations[1]$m + DTFormSituations[2]$m))$V1, main="Situations total", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")

barplot(data.table(rbind(DTFormInteret$v, DTFormInteret$pv, DTFormInteret$n, DTFormInteret$pm, DTFormInteret$m))$V1, main="Interet pour première partie vanilla", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormInteret$v, DTFormInteret$pv, DTFormInteret$n, DTFormInteret$pm, DTFormInteret$m))$V2, main="Interet pour première partie mod", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormInteret[1]$v + DTFormInteret[2]$v, DTFormInteret[1]$pv + DTFormInteret[2]$pv, DTFormInteret[1]$n + DTFormInteret[2]$n, DTFormInteret[1]$pm + DTFormInteret[2]$pm, DTFormInteret[1]$m + DTFormInteret[2]$m))$V1, main="Interet total", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")

barplot(data.table(rbind(DTFormLogique$v, DTFormLogique$pv, DTFormLogique$n, DTFormLogique$pm, DTFormLogique$m))$V1, main="Logique pour première partie vanilla", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormLogique$v, DTFormLogique$pv, DTFormLogique$n, DTFormLogique$pm, DTFormLogique$m))$V2, main="Logique pour première partie mod", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormLogique[1]$v + DTFormLogique[2]$v, DTFormLogique[1]$pv + DTFormLogique[2]$pv, DTFormLogique[1]$n + DTFormLogique[2]$n, DTFormLogique[1]$pm + DTFormLogique[2]$pm, DTFormLogique[1]$m + DTFormLogique[2]$m))$V1, main="Logique total", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")

barplot(data.table(rbind(DTFormFaire$v, DTFormFaire$pv, DTFormFaire$n, DTFormFaire$pm, DTFormFaire$m))$V1, main="Faire pour première partie vanilla", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormFaire$v, DTFormFaire$pv, DTFormFaire$n, DTFormFaire$pm, DTFormFaire$m))$V2, main="Faire pour première partie mod", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormFaire[1]$v + DTFormFaire[2]$v, DTFormFaire[1]$pv + DTFormFaire[2]$pv, DTFormFaire[1]$n + DTFormFaire[2]$n, DTFormFaire[1]$pm + DTFormFaire[2]$pm, DTFormFaire[1]$m + DTFormFaire[2]$m))$V1, main="Faire total", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")

barplot(data.table(rbind(DTFormObjectifs$v, DTFormObjectifs$pv, DTFormObjectifs$n, DTFormObjectifs$pm, DTFormObjectifs$m))$V1, main="Objectifs pour première partie vanilla", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormObjectifs$v, DTFormObjectifs$pv, DTFormObjectifs$n, DTFormObjectifs$pm, DTFormObjectifs$m))$V2, main="Objectifs pour première partie mod", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormObjectifs[1]$v + DTFormObjectifs[2]$v, DTFormObjectifs[1]$pv + DTFormObjectifs[2]$pv, DTFormObjectifs[1]$n + DTFormObjectifs[2]$n, DTFormObjectifs[1]$pm + DTFormFaire[2]$pm, DTFormObjectifs[1]$m + DTFormObjectifs[2]$m))$V1, main="Objectifs total", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")

barplot(data.table(rbind(DTFormManques$v, DTFormManques$pv, DTFormManques$n, DTFormManques$pm, DTFormManques$m))$V1, main="Manques pour première partie vanilla", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormManques$v, DTFormManques$pv, DTFormManques$n, DTFormManques$pm, DTFormManques$m))$V2, main="Manques pour première partie mod", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormManques[1]$v + DTFormManques[2]$v, DTFormManques[1]$pv + DTFormManques[2]$pv, DTFormManques[1]$n + DTFormManques[2]$n, DTFormManques[1]$pm + DTFormManques[2]$pm, DTFormManques[1]$m + DTFormManques[2]$m))$V1, main="Manques total", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")

barplot(data.table(rbind(DTFormSurpris$v, DTFormSurpris$pv, DTFormSurpris$n, DTFormSurpris$pm, DTFormSurpris$m))$V1, main="Surpris pour première partie vanilla", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormSurpris$v, DTFormSurpris$pv, DTFormSurpris$n, DTFormSurpris$pm, DTFormSurpris$m))$V2, main="Surpris pour première partie mod", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormSurpris[1]$v + DTFormSurpris[2]$v, DTFormSurpris[1]$pv + DTFormSurpris[2]$pv, DTFormSurpris[1]$n + DTFormSurpris[2]$n, DTFormSurpris[1]$pm + DTFormSurpris[2]$pm, DTFormSurpris[1]$m + DTFormSurpris[2]$m))$V1, main="Surpris total", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")

barplot(data.table(rbind(DTFormPlaisir$v, DTFormPlaisir$pv, DTFormPlaisir$n, DTFormPlaisir$pm, DTFormPlaisir$m))$V1, main="Plaisir pour première partie vanilla", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormPlaisir$v, DTFormPlaisir$pv, DTFormPlaisir$n, DTFormPlaisir$pm, DTFormPlaisir$m))$V2, main="Plaisir pour première partie mod", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")
barplot(data.table(rbind(DTFormPlaisir[1]$v + DTFormPlaisir[2]$v, DTFormPlaisir[1]$pv + DTFormPlaisir[2]$pv, DTFormPlaisir[1]$n + DTFormPlaisir[2]$n, DTFormPlaisir[1]$pm + DTFormPlaisir[2]$pm, DTFormPlaisir[1]$m + DTFormPlaisir[2]$m))$V1, main="Plaisir total", xlab="Echelle (vanilla à mod)", ylab="Nombre de personnes")


# transformer dtform de façon a avoir pour le q characteristic 1 = v, 2 = pv, 3 = n, 4 = pm etc.

#Transformer pour que pour tout le monde, ca soit 1  plutot vanilla, 5 plutot mod
DTForm$plaisirPlutotMod = DTForm$plaisir;
DTForm[FirstCondition=="mod",plaisirPlutotMod := as.integer(6-plaisir)]

echoPValue <- function(pv){
  
  pv = signif(pv,digits=2)
   
  if(pv<0.001) {
    return(paste(pv,"***"));
  }else if(pv<0.01){ 
    return(paste(pv,"**"));
  }else  if(pv<0.05){ 
    return(paste(pv,"*"));
  }else if(pv<0.1){ 
    return(paste(pv,"."));
  }else{
    return(paste(pv,":("));
  }
  
  return("");
}


res=data.table(vide=0);
res$sens <- echoPValue(t.test(DTForm$sens ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$plaisir <- echoPValue(t.test(DTForm$plaisir ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$interet <- echoPValue(t.test(DTForm$interet ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$faire <- echoPValue(t.test(DTForm$faire ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$situations <- echoPValue(t.test(DTForm$situations ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$surpris <- echoPValue(t.test(DTForm$surpris ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$objectifs <- echoPValue(t.test(DTForm$objectifs ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$manques <- echoPValue(t.test(DTForm$manques ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)
res$logique <- echoPValue(t.test(DTForm$logique ~ DTForm$FirstCondition, var.equal=TRUE)$p.value)


hist(DTFormProcessInt$nb, main="Utilisation des processus", xlab="Processus")

montest <- function(table){
  DTTest <- data.table(nombre=t(table[1]))
  DTTest$content <- 1:5
  print(plot(DTTest))
  fit <- glm(content ~ nombre.V1, data=DTTest)
  print(summary(fit))  
}

DTTest <- data.table(nombre=t(DTFormPlaisir[1]))
barplot(DTTest$nombre.V1)

montest(DTFormPlaisir)
montest(DTFormSens)
montest(DTFormSituations)
montest(DTFormSurpris)
montest(DTFormPlaisir)


barplot(table(DTForm$frequence), xlab="Fréquence", ylab="Nombre de personnes", main="Fréquence de jeu",las=2)
barplot(table(DTForm$age), xlab="Age", ylab="Nombre de personnes", main="Répartition de la population par âge",las=2)
barplot(table(DTForm$minecraft), xlab="Expérience", ylab="Nombre de personnes", main="Expérience de Minecraft",las=2)
barplot(table(DTAInt$actionName), xlab="Actions", ylab="frequence", main="Actor interaction",las=2)
barplot(table(DTAAInt$actionName), xlab="Actions", ylab="frequence", main="Actor Actor interaction",las=2)

DTPlacesNbPlaces <- DTPlaces[,.(nbPlaces=nrow(.SD)),by=.(MyPlayerId)]
barplot(table(DTPlacesNbPlaces$nbPlaces), xlab="Nb places", ylab="frequence", main="Number of places")
```

###Cartes
```{r fig.width=4, fig.height=4,echo=FALSE,out.extra=' style="float:left"'}
#trace les cartes

#on prend les positions min et max sans tenir compte du mod, pour avoir les memes echelles sur les plots
DTAPosMinMax <- DTAPos[,.(minX=min(X),maxX=max(X),minZ=min(Z),maxZ=max(Z)),by=.(MyPlayerId)]

plotMap <- function (xs,ys,mod,player){
  df <- data.frame(x=xs,y=ys)
  pl <- ggplot(df,aes(x=xs,y=ys))
  pl <- pl + geom_point(alpha = 0.2) #+ stat_binhex() 
  pl <- pl + ggtitle(paste(player,mod))
  df <- data.frame(x=mean(xs),y=mean(ys))
  pl <- pl + geom_point(data = df, aes(x=mean(xs),y=mean(ys)), colour = "red")
  
  DTPlaceNow <- DTPlaces[MyPlayerId==player];
  df <- data.frame(x=DTPlaceNow$X,y=DTPlaceNow$Z)
  pl <- pl + geom_point(data = df, aes(x=df$x,y=df$y), colour = "green")
  
  DTMinMaxNow <- DTAPosMinMax[MyPlayerId==player];
  pl <- pl + xlim(DTMinMaxNow$minX,DTMinMaxNow$maxX)
  pl <- pl + ylim(DTMinMaxNow$minZ,DTMinMaxNow$maxZ)
  
  print(pl)  
}
setkey(DTAPos,MyPlayerId,time)
void <- DTAPos[,{plotMap(X,Z,MyMod,MyPlayerId);NULL},by=.(MyMod,MyPlayerId)]
```
<div style="clear:both">&nbsp;</div>

```{r echo=FALSE}
###Lien entre mode de jeu et nombre de lieux
###ERROR : on ne stoque pas le temps de lieux, donc impossible de comparer le nombre de lieux entre chaque mod

#ajout des variables
#DTPlacesNbPlaces <- DTPlaces[,.(nbPlaces=nrow(.SD)),by=.(MyMod,MyPlayerId)]
#barplot(table(DTPlacesNbPlaces$nbPlaces), xlab="Nb places", ylab="frequence", main="Number of places")
#print(DTPlacesNbPlaces)

#data <- DTPlacesNbPlaces[MyMod=="vanilla",nbPlaces] - DTPlacesNbPlaces[MyMod=="mod",nbPlaces];
#hist(data,xlab="diff nbLieux  (vanilla - mod)", main="Delta nombre de lieux vanilla/mod")

#lien 
#fit <- aov(nbPlaces ~ MyMod, data=DTPlacesNbPlaces)
#summary(fit)
```

###Lien entre mode de jeu et nombre d'interaction

```{r echo=FALSE}
#ajout des variables
DTAAIntNb <- DTAAIntPlayer[,.(nbInt=nrow(.SD)),by=.(MyMod,MyPlayerId)]
DTAIntNb <- DTAInt[,.(nbInt=nrow(.SD)),by=.(MyMod,MyPlayerId)]
DTIntNb <- DTAAIntNb
DTIntNb$nbInt = DTAAIntNb$nbInt + DTAIntNb$nbInt

#lien 
fit <- aov(nbInt ~ MyMod, data=DTIntNb)
sum_fit = unlist(summary(fit))
```

Le nombre d'interactions est en moyenne de **`r round(mean(DTIntNb[MyMod=="vanilla"]$nbInt))`** ($\sigma$=`r round(sd(DTIntNb[MyMod=="vanilla"]$nbInt),1)`) en mode vanilla et de **`r round(mean(DTIntNb[MyMod=="mod"]$nbInt))`** ($\sigma$=`r round(sd(DTIntNb[MyMod=="mod"]$nbInt),1)`) en mode narration émergente. Cette différence a un taux de significativité de **`r sum_fit["Pr(>F)1"]`** 

```{r echo=FALSE}
#data <- DTIntNb[MyMod=="vanilla",nbInt]
#data <- rbind(data,DTIntNb[MyMod=="mod",nbInt])
#barplot(data, xlab="nbActions pour chaque joueur vanilla/mod", ylab="frequence", main="Actor Actor interaction", beside=TRUE,col=c("orange","darkgreen"))
data <- DTIntNb[MyMod=="vanilla",nbInt] - DTIntNb[MyMod=="mod",nbInt];
hist(data,xlab="diff nbActions  (vanilla - mod)", main="Delta quantite d'interaction vanilla/mod")
summary(fit)
```


###Lien entre mode de jeu et mort du joueur
```{r echo=FALSE}
#ajout des variables
DTAAIntNb <- DTAAIntPlayer[action==9,.(nbInt=nrow(.SD)),by=.(MyMod,MyPlayerId)]

#on met à 0 la ou il y'a des NA (si un mec est pas mort dans un mode)
DTAAIntNb <- merge(DTAAIntNb[,CJ(MyMod=unique(MyMod),MyPlayerId=unique(MyPlayerId))],DTAAIntNb,by=c('MyPlayerId','MyMod'),all=TRUE)[,.(MyMod,MyPlayerId,nbInt=ifelse(!is.na(nbInt),nbInt,0))]



#DTAIntNb <- DTAInt[action==9,.(nbInt=nrow(.SD)),by=.(MyMod,MyPlayerId)]
DTIntNb <- DTAAIntNb
#DTIntNb$nbInt = DTAAIntNb$nbInt + DTAIntNb$nbInt
print(DTIntNb)
#data <- DTIntNb[MyMod=="vanilla",nbInt]
#data <- rbind(data,DTIntNb[MyMod=="mod",nbInt])
#barplot(data, xlab="nbMorts pour chaque joueur vanilla/mod", ylab="frequence", main="Actor Actor interaction", beside=TRUE,col=c("orange","darkgreen"))
data <- DTIntNb[MyMod=="vanilla",nbInt] - DTIntNb[MyMod=="mod",nbInt];
hist(data,xlab="diff nbMorts  (vanilla - mod)", main="Delta quantite mort joueur vanilla/mod")
#lien 
fit <- aov(nbInt ~ MyMod, data=DTIntNb)
#plot(x=DTLoc$nbFail, y=DTLoc$erreurdiff, main=titre)
summary(fit)
```

###Lien entre mode de jeu et distance au barycentre (valeur absolue)
```{r echo=FALSE}
#calcul du barycentre
DTAPosBarycentre <- DTAPos[,.(xBar=mean(X),yBar=mean(Y),zBar=mean(Z)),by=.(MyMod,MyPlayerId)]
DTADistBarycentre <- DTAPos[,.(dist=sqrt((X-mean(X)) * (X-mean(X)) + (Y-mean(Y)) * (Y-mean(Y)) + (Z-mean(Z)) * (Z-mean(Z)) )),by=.(MyMod,MyPlayerId)]
DTADistBarycentreMean <- DTADistBarycentre[,.(mdist=mean(dist),sddist=sd(dist)),by=.(MyMod,MyPlayerId)]
print(DTADistBarycentreMean)

data <- DTADistBarycentreMean[MyMod=="vanilla",mdist] - DTADistBarycentreMean[MyMod=="mod",mdist];
hist(data,xlab="diff dist barycentre vanilla - mod", main="Delta dist barycentre vanilla/mod")

#lien 
fit <- aov(mdist ~ MyMod, data=DTADistBarycentreMean)
#plot(x=DTLoc$nbFail, y=DTLoc$erreurdiff, main=titre)
summary(fit)
```

###Lien entre mode de jeu et distance totale (valeur absolue)
```{r echo=FALSE}
#calcul du barycentre
setkeyv(DTAPos,c("MyPlayerId","time"))
DTADistStep <- DTAPos[,.(dist=sqrt((X-lag(X)) * (X-lag(X)) + (Y-lag(Y)) * (Y-lag(Y)) + (Z-lag(Z)) * (Z-lag(Z)) )),by=.(MyMod,MyPlayerId)]

DTADistStep <- DTAPos[,.(dx=(X-c(X[1], X[-.N])),dy=(Y-c(Y[1], Y[-.N])),dz=(Z-c(Z[1], Z[-.N]))),by=.(MyMod,MyPlayerId)]
DTADistStep <- DTADistStep[,.(dist=sqrt(dx*dx+dz*dz+dy*dy)),by=.(MyMod,MyPlayerId)]
DTADistStep <- DTADistStep[,.(distSum=sum(dist)),by=.(MyMod,MyPlayerId)]

print(DTADistStep)

data <- DTADistStep[MyMod=="vanilla",distSum] - DTADistStep[MyMod=="mod",distSum];
hist(data,xlab="diff distance totale  vanilla - mod", main="Delta dist totale vanilla/mod")

#lien 
fit <- aov(distSum ~ MyMod, data=DTADistStep)
#plot(x=DTLoc$nbFail, y=DTLoc$erreurdiff, main=titre)
summary(fit)
```

###Idees fit :
- checker leffet de l'ordre en prenant les réponses des cas firstcondition == vanilla et inversement
- checker le nombre typés des interactions (kill, dig, build, etc.) -> chi2 sur col (type int) et ligne (type partie)
- checker comment tester les likert scales

###Idees descriptif:
- quantite d'interaction avec les process

###Nettoyage
- virer ceux qui n'ont pas joue tout le temps (temps sans action trop long)
- virer ceux qui n'ont eu que vanilla ou que mod (table game_type avec une seule ligne)



